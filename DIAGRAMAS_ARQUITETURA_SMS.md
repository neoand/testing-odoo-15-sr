# Diagramas de Arquitetura SMS - Odoo 15

**Data:** 16/11/2025
**Objetivo:** VisualizaÃ§Ã£o da arquitetura completa do sistema SMS

---

## 1. ARQUITETURA GERAL DE MÃ“DULOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ODOO 15 - CORE                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   base   â”‚  â”‚   mail   â”‚  â”‚ contacts â”‚  â”‚   web    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ depends
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CAMADA 1: SMS BASE                           â”‚
â”‚                    (sms_base_sr)                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚sms.message â”‚  â”‚sms.provider â”‚  â”‚sms.template  â”‚            â”‚
â”‚  â”‚  (core)    â”‚  â”‚ (abstract)  â”‚  â”‚  (render)    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚res.partner  â”‚  â”‚ sms.compose (wizard)         â”‚            â”‚
â”‚  â”‚  (extend)   â”‚  â”‚                              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ depends
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 CAMADA 2: PROVIDER KOLMEYA                      â”‚
â”‚                    (sms_kolmeya)                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ sms.provider     â”‚â—„â”€â”€â”€â”€â”€â”€â”¤  KolmeyaAPI         â”‚           â”‚
â”‚  â”‚   (inherit)      â”‚       â”‚  (Python class)     â”‚           â”‚
â”‚  â”‚ + kolmeya type   â”‚       â”‚  - send_sms()       â”‚           â”‚
â”‚  â”‚ + api_token      â”‚       â”‚  - send_batch()     â”‚           â”‚
â”‚  â”‚ + segment_id     â”‚       â”‚  - get_balance()    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  - check_status()   â”‚           â”‚
â”‚                             â”‚  - blacklist ops    â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”‚  Webhooks        â”‚                                          â”‚
â”‚  â”‚  - /reply        â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  - /status       â”‚â—„â”€â”€â”€â”€â”€â”€â”¤   Kolmeya API       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  (External REST)    â”‚           â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ depends
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CAMADA 3: CHATROOM INTEGRATION                     â”‚
â”‚                  (contact_center_sms)                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ acrux.chat.connector   â”‚  â”‚ acrux.chat.conversation  â”‚     â”‚
â”‚  â”‚      (inherit)         â”‚  â”‚       (inherit)          â”‚     â”‚
â”‚  â”‚ + connector_type='sms' â”‚  â”‚ + channel_type='sms'     â”‚     â”‚
â”‚  â”‚ + sms_provider_id      â”‚  â”‚ + sms_message_id         â”‚     â”‚
â”‚  â”‚ + sms_stats            â”‚  â”‚ + create_from_sms()      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ + send_sms_message()     â”‚     â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ acrux.chat.message     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚      (inherit)         â”‚  â”‚  Webhooks (override)     â”‚     â”‚
â”‚  â”‚ + sms_message_id       â”‚  â”‚  - /reply (chatroom)     â”‚     â”‚
â”‚  â”‚ + is_sms               â”‚  â”‚  - /status (chatroom)    â”‚     â”‚
â”‚  â”‚ + sms_cost             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ depends
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CAMADA 4: ADVANCED FEATURES (NOVO)                   â”‚
â”‚              (chatroom_sms_advanced v2)                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ sms.message (inherit)  â”‚  â”‚ sms.provider (inherit)   â”‚     â”‚
â”‚  â”‚ + scheduled_date       â”‚  â”‚ + auto_balance_check     â”‚     â”‚
â”‚  â”‚ + campaign_id          â”‚  â”‚ + balance_threshold      â”‚     â”‚
â”‚  â”‚ + link_tracking_ids    â”‚  â”‚ + dnd_enabled            â”‚     â”‚
â”‚  â”‚ + tag_ids              â”‚  â”‚ + webhook_url_custom     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚             NOVOS MODELOS                            â”‚     â”‚
â”‚  â”‚                                                      â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚  â”‚chatroom.sms.scheduledâ”‚  â”‚chatroom.sms.campaignâ”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - agendamento       â”‚  â”‚  - campanhas SMS     â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - recorrÃªncia       â”‚  â”‚  - segmentaÃ§Ã£o       â”‚ â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚                                                      â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚  â”‚chatroom.sms.blacklistâ”‚  â”‚chatroom.sms.dashboardâ”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - DND management    â”‚  â”‚  - SQL view          â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - sync Kolmeya      â”‚  â”‚  - estatÃ­sticas      â”‚ â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. FLUXO DE ENVIO DE SMS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUÃRIO    â”‚
â”‚  (Interface) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Abre res.partner
       â”‚    Clica "Send SMS"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sms.compose     â”‚
â”‚   (wizard)       â”‚â—„â”€â”€â”€ Template opcional
â”‚                  â”‚     (sms.template)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Renderiza template
       â”‚    com dados partner
       â”‚ 3. Clica "Send"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sms.message     â”‚
â”‚                  â”‚
â”‚  state='draft'   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. action_send()
       â”‚
       â”œâ”€â”€â–º Verifica blacklist
       â”‚    (chatroom.sms.blacklist)
       â”‚
       â”œâ”€â”€â–º Verifica DND
       â”‚    (sms.provider.dnd_enabled)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sms.provider    â”‚
â”‚  (Kolmeya)       â”‚
â”‚                  â”‚
â”‚  _send_sms()     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Cria KolmeyaAPI instance
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   KolmeyaAPI         â”‚
â”‚                      â”‚
â”‚   send_sms()         â”‚
â”‚   {                  â”‚
â”‚     phone: "...",    â”‚
â”‚     message: "...",  â”‚
â”‚     reference: "..." â”‚
â”‚   }                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. POST /api/v1/sms/store
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Kolmeya Server     â”‚
â”‚   (External API)     â”‚
â”‚                      â”‚
â”‚   Returns:           â”‚
â”‚   {                  â”‚
â”‚     "id": "job123",  â”‚
â”‚     "valids": [{     â”‚
â”‚       "id": "msg456" â”‚
â”‚     }]               â”‚
â”‚   }                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Response
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sms.message     â”‚
â”‚                  â”‚
â”‚  state='sent'    â”‚
â”‚  provider_msg_id â”‚
â”‚  provider_job_id â”‚
â”‚  sent_date       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 8. Posta no chatter
       â”‚    do partner
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  res.partner     â”‚
â”‚                  â”‚
â”‚  (chatter)       â”‚
â”‚  "ğŸ“¤ SMS sent"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Webhook de Status (AssÃ­ncrono)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Kolmeya Server     â”‚
â”‚                      â”‚
â”‚   SMS delivered!     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /kolmeya/webhook/status
       â”‚ {
       â”‚   "id": "msg456",
       â”‚   "status": "entregue",
       â”‚   "status_code": 3
       â”‚ }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller (webhook)     â”‚
â”‚                          â”‚
â”‚ /kolmeya/webhook/status  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Busca sms.message
       â”‚    por provider_message_id
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sms.message     â”‚
â”‚                  â”‚
â”‚  state='delivered'â”‚
â”‚  delivered_date  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Posta no chatter
       â”‚    "âœ… Delivered"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  res.partner     â”‚
â”‚  (chatter update)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. FLUXO DE RECEBIMENTO DE SMS (REPLY)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cliente            â”‚
â”‚   (Celular)          â”‚
â”‚                      â”‚
â”‚   Responde SMS       â”‚
â”‚   "Sim, aceito!"     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ SMS Reply via operadora
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Kolmeya Server     â”‚
â”‚                      â”‚
â”‚   Recebe reply       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /kolmeya/webhook/reply
       â”‚ {
       â”‚   "phone": "5548991234567",
       â”‚   "message": "Sim, aceito!",
       â”‚   "reference": "original_msg_id"
       â”‚ }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller (webhook)           â”‚
â”‚                                â”‚
â”‚ /kolmeya/webhook/reply         â”‚
â”‚ (contact_center_sms version)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Busca/cria res.partner
       â”‚    por telefone
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  res.partner     â”‚
â”‚                  â”‚
â”‚  phone=548...    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Cria SMS incoming
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sms.message     â”‚
â”‚                  â”‚
â”‚  direction='incoming'
â”‚  state='delivered'â”‚
â”‚  body="Sim..."   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Busca conversa ChatRoom
       â”‚    (phone + channel_type='sms')
       â”‚
       â”œâ”€â”€â–º Existe?
       â”‚    â”‚
       â”‚    â”œâ”€â”€NOâ”€â”€â–º create_from_sms()
       â”‚    â”‚         â”‚
       â”‚    â”‚         â–¼
       â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚    â”‚    â”‚acrux.chat.conversation â”‚
       â”‚    â”‚    â”‚  channel_type='sms'    â”‚
       â”‚    â”‚    â”‚  number="5548..."      â”‚
       â”‚    â”‚    â”‚  partner_id            â”‚
       â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚    â”‚             â”‚
       â”‚    â”‚             â”‚ _auto_assign_agent()
       â”‚    â”‚             â–¼
       â”‚    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚    â”‚         â”‚  Agent   â”‚
       â”‚    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚    â”‚
       â”‚    â””â”€â”€YESâ”€â”€â–º _add_sms_to_thread()
       â”‚              â”‚
       â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ acrux.chat.message         â”‚
â”‚                            â”‚
â”‚  ttype='text'              â”‚
â”‚  text="Sim, aceito!"       â”‚
â”‚  from_me=False             â”‚
â”‚  sms_message_id            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. _notify_new_message()
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Odoo Bus (WebSocket)     â”‚
â”‚                            â”‚
â”‚   Notifica agente          â”‚
â”‚   em tempo real            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Interface ChatRoom       â”‚
â”‚   (Browser do Agente)      â”‚
â”‚                            â”‚
â”‚   ğŸ’¬ Nova mensagem!        â”‚
â”‚   "Sim, aceito!"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ESTRUTURA DE BANCO DE DADOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BANCO DE DADOS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sms_message        â”‚         â”‚  res_partner         â”‚
â”‚                     â”‚         â”‚                      â”‚
â”‚  id (PK)            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  id (PK)             â”‚
â”‚  partner_id (FK)    â”‚         â”‚  name                â”‚
â”‚  user_id (FK)       â”‚         â”‚  phone               â”‚
â”‚  provider_id (FK)   â”‚         â”‚  mobile              â”‚
â”‚  campaign_id (FK)   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  parent_id (FK self)â”‚
â”‚                     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  phone              â”‚         â”‚  res_users           â”‚
â”‚  body               â”‚         â”‚                      â”‚
â”‚  direction          â”‚         â”‚  id (PK)             â”‚
â”‚  state              â”‚         â”‚  name                â”‚
â”‚  provider_message_idâ”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  provider_job_id    â”‚                   â–²
â”‚  scheduled_date     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  sent_date          â”‚
â”‚  delivered_date     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  char_count         â”‚         â”‚  sms_provider        â”‚
â”‚  sms_count          â”‚         â”‚                      â”‚
â”‚  cost               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  id (PK)             â”‚
â”‚  error_message      â”‚         â”‚  name                â”‚
â”‚                     â”‚         â”‚  provider_type       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  kolmeya_api_token   â”‚
         â–²                      â”‚  kolmeya_segment_id  â”‚
         â”‚                      â”‚  kolmeya_balance     â”‚
         â”‚                      â”‚  auto_balance_check  â”‚
         â”‚                      â”‚  dnd_enabled         â”‚
         â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ chatroom_sms_campaign      â”‚
â”‚                            â”‚
â”‚  id (PK)                   â”‚
â”‚  name                      â”‚
â”‚  template_id (FK)          â”‚
â”‚  provider_id (FK)          â”‚
â”‚  state                     â”‚
â”‚  total_sent                â”‚
â”‚  total_delivered           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CHATROOM (WhatsApp Connector)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ acrux_chat_connector     â”‚      â”‚ acrux_chat_conversation â”‚
â”‚                          â”‚      â”‚                         â”‚
â”‚  id (PK)                 â”‚â—„â”€â”€â”€â”€â”€â”¤  id (PK)                â”‚
â”‚  name                    â”‚      â”‚  connector_id (FK)      â”‚
â”‚  connector_type          â”‚      â”‚  res_partner_id (FK)    â”‚
â”‚   - apichat              â”‚      â”‚  sms_message_id (FK)    â”‚
â”‚   - gupshup              â”‚      â”‚  agent_id (FK)          â”‚
â”‚   - sms â—„â”€â”€â”€â”€NOVO        â”‚      â”‚                         â”‚
â”‚  sms_provider_id (FK)    â”‚      â”‚  name                   â”‚
â”‚  sms_sent_count          â”‚      â”‚  number                 â”‚
â”‚  sms_received_count      â”‚      â”‚  channel_type           â”‚
â”‚                          â”‚      â”‚   - whatsapp            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   - sms â—„â”€â”€â”€â”€NOVO       â”‚
                                  â”‚   - instagram           â”‚
                                  â”‚  border_color           â”‚
                                  â”‚  last_received          â”‚
                                  â”‚  last_activity          â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ acrux_chat_message      â”‚
                                  â”‚                         â”‚
                                  â”‚  id (PK)                â”‚
                                  â”‚  contact_id (FK)        â”‚
                                  â”‚  sms_message_id (FK)    â”‚
                                  â”‚  ttype                  â”‚
                                  â”‚  text                   â”‚
                                  â”‚  from_me                â”‚
                                  â”‚  date_message           â”‚
                                  â”‚  is_sms                 â”‚
                                  â”‚  sms_segment_count      â”‚
                                  â”‚  sms_cost               â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. MAPA DE STATES (sms.message)

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   DRAFT   â”‚ â—„â”€â”€ Estado inicial
                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ action_send()
                              â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚            â”‚            â”‚
                 â”‚            â”‚            â”‚
           Blacklist?    Scheduled?    Envio OK
                 â”‚            â”‚            â”‚
                 â–¼            â–¼            â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ REJECTED  â”‚ â”‚ OUTGOING  â”‚ â”‚   SENT    â”‚
         â”‚           â”‚ â”‚           â”‚ â”‚           â”‚
         â”‚ (blocked) â”‚ â”‚ (pending) â”‚ â”‚ (enviado) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                             â”‚             â”‚
                             â”‚             â”‚
                    Webhook: status=3      â”‚
                             â”‚             â”‚
                             â–¼             â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
                      â”‚ DELIVERED â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚           â”‚
                      â”‚ (entregue)â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


         Webhook: status=4,5,6
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   ERROR   â”‚
         â”‚           â”‚
         â”‚  (falhou) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


         Manual cancel
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ CANCELED  â”‚
         â”‚           â”‚
         â”‚(cancelado)â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


         Webhook: status=6
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  EXPIRED  â”‚
         â”‚           â”‚
         â”‚(expirado) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. FLUXO DE AGENDAMENTO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUÃRIO    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Cria SMS via wizard
       â”‚    Marca "Schedule"
       â”‚    Define data/hora
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sms.message     â”‚
â”‚                  â”‚
â”‚  state='draft'   â”‚
â”‚  scheduled_date  â”‚
â”‚  = 2025-11-20    â”‚
â”‚    15:00:00      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Cria agendamento
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚chatroom.sms.scheduled  â”‚
â”‚                        â”‚
â”‚  sms_message_id        â”‚
â”‚  scheduled_date        â”‚
â”‚  state='pending'       â”‚
â”‚  is_recurring=False    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ CRON (roda a cada 5 minutos)
       â”‚
       â”‚ SELECT * FROM chatroom_sms_scheduled
       â”‚ WHERE state='pending'
       â”‚   AND scheduled_date <= NOW()
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  cron_send_scheduled   â”‚
â”‚                        â”‚
â”‚  Para cada agendamento:â”‚
â”‚  - sms.action_send()   â”‚
â”‚  - state='sent'        â”‚
â”‚                        â”‚
â”‚  Se is_recurring:      â”‚
â”‚  - Cria prÃ³ximo        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agendamento Recorrente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agendamento DiÃ¡rio    â”‚
â”‚                        â”‚
â”‚  scheduled_date:       â”‚
â”‚  2025-11-16 09:00      â”‚
â”‚  is_recurring: True    â”‚
â”‚  recurrence_type: dailyâ”‚
â”‚  recurrence_interval:1 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Enviado 2025-11-16 09:00
       â”‚
       â”œâ”€â”€â–º _create_next_recurrence()
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Novo Agendamento      â”‚
â”‚                        â”‚
â”‚  scheduled_date:       â”‚
â”‚  2025-11-17 09:00      â”‚
â”‚  (amanhÃ£)              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Enviado 2025-11-17 09:00
       â”‚
       â”œâ”€â”€â–º _create_next_recurrence()
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Novo Agendamento      â”‚
â”‚  2025-11-18 09:00      â”‚
â”‚  (e assim por diante)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. DASHBOARD - SQL VIEW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SELECT FROM sms_message GROUP BY date              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Cria VIEW SQL
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  chatroom_sms_dashboard (VIEW)                             â”‚
â”‚                                                            â”‚
â”‚  date          | total_sent | delivered | failed | cost   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  2025-11-16    |    150     |    142    |   8    | 15.00  â”‚
â”‚  2025-11-15    |    203     |    195    |   8    | 20.30  â”‚
â”‚  2025-11-14    |     89     |     87    |   2    |  8.90  â”‚
â”‚  ...           |    ...     |    ...    |  ...   |  ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Usado em views
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VIEWS DO DASHBOARD                      â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Graph View      â”‚    â”‚   Kanban View        â”‚       â”‚
â”‚  â”‚   (Bar Chart)     â”‚    â”‚   (Cards por dia)    â”‚       â”‚
â”‚  â”‚                   â”‚    â”‚                      â”‚       â”‚
â”‚  â”‚   Taxa Entrega    â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
â”‚  â”‚   por Dia         â”‚    â”‚   â”‚ 2025-11-16 â”‚    â”‚       â”‚
â”‚  â”‚                   â”‚    â”‚   â”‚ 150 SMS    â”‚    â”‚       â”‚
â”‚  â”‚   â–ˆâ–ˆâ–ˆâ–ˆ 94%        â”‚    â”‚   â”‚ 94% OK     â”‚    â”‚       â”‚
â”‚  â”‚   â–ˆâ–ˆâ–ˆâ–ˆ 96%        â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
â”‚  â”‚   â–ˆâ–ˆâ–ˆâ–ˆ 98%        â”‚    â”‚                      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Pivot View (AnÃ¡lise Multidimensional)       â”‚       â”‚
â”‚  â”‚                                                â”‚       â”‚
â”‚  â”‚           Provider A  â”‚  Provider B  â”‚  Total â”‚       â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚
â”‚  â”‚   Enviado    100      â”‚     50       â”‚  150   â”‚       â”‚
â”‚  â”‚   Entregue    95      â”‚     47       â”‚  142   â”‚       â”‚
â”‚  â”‚   Falhou       5      â”‚      3       â”‚    8   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. INTEGRAÃ‡ÃƒO COMPLETA (Big Picture)

```
                        CLIENTE (Celular)
                              â”‚
                              â”‚ Envia/Recebe SMS
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   KOLMEYA API       â”‚
                    â”‚  (Gateway SMS)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                  â”‚
           Envio  â”‚                  â”‚  Webhooks
             â–¼    â”‚                  â”‚    â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ KolmeyaAPI   â”‚         â”‚  Controllers  â”‚
      â”‚ (Python)     â”‚         â”‚  /webhook/*   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                     â”‚
              â”‚                     â”‚
              â–¼                     â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         ODOO 15 SERVER                 â”‚
     â”‚                                        â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚  â”‚      SMS BASE (sms_base_sr)      â”‚ â”‚
     â”‚  â”‚  - sms.message                   â”‚ â”‚
     â”‚  â”‚  - sms.provider                  â”‚ â”‚
     â”‚  â”‚  - sms.template                  â”‚ â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
     â”‚               â”‚                        â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚  â”‚  SMS KOLMEYA (sms_kolmeya)       â”‚ â”‚
     â”‚  â”‚  - KolmeyaAPI                    â”‚ â”‚
     â”‚  â”‚  - sms.provider (extend)         â”‚ â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
     â”‚               â”‚                        â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚  â”‚ CHATROOM (contact_center_sms)    â”‚ â”‚
     â”‚  â”‚  - acrux.chat.conversation       â”‚ â”‚
     â”‚  â”‚  - acrux.chat.message            â”‚ â”‚
     â”‚  â”‚  - channel_type='sms'            â”‚ â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
     â”‚               â”‚                        â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚  â”‚ ADVANCED (chatroom_sms_advanced) â”‚ â”‚
     â”‚  â”‚  - Agendamento                   â”‚ â”‚
     â”‚  â”‚  - Campanhas                     â”‚ â”‚
     â”‚  â”‚  - Dashboard                     â”‚ â”‚
     â”‚  â”‚  - Blacklist                     â”‚ â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ WebSocket (Odoo Bus)
                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  AGENTE          â”‚
           â”‚  (Browser)       â”‚
           â”‚                  â”‚
           â”‚  Interface       â”‚
           â”‚  ChatRoom        â”‚
           â”‚                  â”‚
           â”‚  ğŸ’¬ SMS          â”‚
           â”‚  ğŸ’¬ WhatsApp     â”‚
           â”‚  ğŸ’¬ Instagram    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. COMPARAÃ‡ÃƒO: ANTES vs DEPOIS

### ANTES (Sistema Duplicado)

```
chatroom_sms_advanced (ERRADO)
â”‚
â”œâ”€â”€ chatroom.sms.log â—„â”€â”€â”€â”€â”
â”‚   (modelo duplicado)     â”‚  CONFLITO!
â”‚                          â”‚
â”œâ”€â”€ chatroom.sms.api â—„â”€â”€â”€â”€â”¤  Funcionalidade
â”‚   (API duplicada)        â”‚  JÃ EXISTE
â”‚                          â”‚  em outros mÃ³dulos
â”œâ”€â”€ chatroom.room â—„â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   (conceito duplicado)   â”‚
â”‚                          â”‚
â””â”€â”€ Webhooks prÃ³prios â—„â”€â”€â”€â”˜
    (endpoints conflitantes)


RESULTADO: 80% cÃ³digo duplicado, conflitos, bugs
```

### DEPOIS (Sistema Integrado)

```
chatroom_sms_advanced (CORRETO)
â”‚
â”œâ”€â”€ sms.message (inherit) â—„â”€â”€â”
â”‚   + scheduled_date          â”‚
â”‚   + campaign_id             â”‚  EXTENDS
â”‚                             â”‚  modelos existentes
â”œâ”€â”€ sms.provider (inherit) â—„â”€â”¤
â”‚   + auto_balance_check      â”‚
â”‚                             â”‚
â”œâ”€â”€ acrux.chat.conversationâ—„â”€â”˜
â”‚   + sms_last_sent
â”‚
â”œâ”€â”€ chatroom.sms.scheduled â—„â”€â”
â”‚   (novo modelo)             â”‚
â”‚                             â”‚  ADICIONA
â”œâ”€â”€ chatroom.sms.campaign â—„â”€â”€â”¤  funcionalidades
â”‚   (novo modelo)             â”‚  REALMENTE NOVAS
â”‚                             â”‚
â””â”€â”€ chatroom.sms.dashboardâ—„â”€â”€â”˜
    (novo modelo)


RESULTADO: 80% reuso, sem conflitos, manutenÃ­vel
```

---

## 10. TIMELINE DE IMPLEMENTAÃ‡ÃƒO

```
Semana 1
â”œâ”€â”€ Dia 1: Backup + PreparaÃ§Ã£o
â”œâ”€â”€ Dia 2: Limpeza + Manifest
â”œâ”€â”€ Dia 3: sms.message (inherit)
â”œâ”€â”€ Dia 4: sms.provider (inherit)
â””â”€â”€ Dia 5: chatroom.conversation (inherit)

Semana 2
â”œâ”€â”€ Dia 6: chatroom.sms.scheduled
â”œâ”€â”€ Dia 7: chatroom.sms.campaign
â”œâ”€â”€ Dia 8: chatroom.sms.blacklist
â”œâ”€â”€ Dia 9: chatroom.sms.dashboard
â””â”€â”€ Dia 10: Wizard bulk send (adapt)

Semana 3
â”œâ”€â”€ Dia 11: Testes unitÃ¡rios
â”œâ”€â”€ Dia 12: Testes integraÃ§Ã£o
â”œâ”€â”€ Dia 13: Deploy staging
â”œâ”€â”€ Dia 14: Testes usuÃ¡rios
â””â”€â”€ Dia 15: Deploy produÃ§Ã£o
```

---

**FIM DOS DIAGRAMAS**

Estes diagramas fornecem uma visÃ£o visual completa da arquitetura SMS no Odoo 15.
