# üîß Solu√ß√£o Erro 502 Bad Gateway - 19/11/2025

## üìã Problema Identificado

**Erro:** `502 Bad Gateway` ao acessar o Odoo via web
- `favicon.ico:1 Failed to load resource: the server responded with a status of 502 ()`
- `web#action=37&model=ir.module.module&view_type=kanban&menu_id=5:1 Failed to load resource: the server responded with a status of 502 ()`

## üîç Causa Raiz

O Odoo estava rodando em **modo debug** com `--workers=0`, o que causava:
- Processamento lento de requisi√ß√µes
- Timeouts no Nginx
- Erros 502 quando o Nginx n√£o conseguia se conectar ao Odoo a tempo

## ‚úÖ Solu√ß√£o Aplicada

### 1. Diagn√≥stico
Script criado: `diagnose_502.sh`
- Verificou status do Odoo Server
- Verificou processos ativos
- Verificou logs do Nginx e Odoo
- Confirmou que Odoo estava escutando na porta 8069

### 2. Corre√ß√£o
Script criado: `fix_502_restart_odoo.sh`
- Parou o servi√ßo Odoo corretamente
- Limpou processos √≥rf√£os
- Reiniciou o Odoo com configura√ß√£o correta (9 workers)
- Verificou que est√° funcionando (HTTP 200)

### 3. Resultado
- ‚úÖ Odoo rodando com **9 workers** (configura√ß√£o de produ√ß√£o)
- ‚úÖ Escutando na porta **8069**
- ‚úÖ Teste HTTP retornou **200 OK**
- ‚úÖ Nginx reiniciado para reconhecer o Odoo

## üìù Scripts Criados

### `diagnose_502.sh`
Script de diagn√≥stico completo que verifica:
- Status do Odoo Server
- Processos Odoo ativos
- Status do Nginx
- Logs recentes
- Porta de escuta
- Conex√µes PostgreSQL

### `fix_502_restart_odoo.sh`
Script de corre√ß√£o que:
- Para o Odoo corretamente
- Limpa processos √≥rf√£os
- Reinicia com configura√ß√£o correta
- Verifica status e conectividade

## üöÄ Como Usar

### Diagn√≥stico
```bash
./diagnose_502.sh
```

### Corre√ß√£o
```bash
./fix_502_restart_odoo.sh
```

### Reiniciar Nginx (se necess√°rio)
```bash
gcloud compute ssh odoo-sr-tensting --zone=southamerica-east1-b \
  --command="sudo systemctl restart nginx"
```

## üîÑ Preven√ß√£o

### Monitoramento
- Verificar periodicamente se o Odoo est√° rodando com workers corretos
- Monitorar logs do Nginx para erros 502
- Verificar uso de mem√≥ria e CPU

### Comandos √öteis
```bash
# Verificar status
gcloud compute ssh odoo-sr-tensting --zone=southamerica-east1-b \
  --command="sudo systemctl status odoo-server"

# Ver logs em tempo real
gcloud compute ssh odoo-sr-tensting --zone=southamerica-east1-b \
  --command="sudo tail -f /var/log/odoo/odoo-server.log"

# Verificar workers
gcloud compute ssh odoo-sr-tensting --zone=southamerica-east1-b \
  --command="ps aux | grep odoo-bin | grep -v grep | wc -l"
```

## ‚ö†Ô∏è Warnings Encontrados (N√£o Cr√≠ticos)

Durante o restart, foram encontrados warnings sobre par√¢metros de campos:
- `track_visibility` (deprecated no Odoo 15)
- `tracking` (par√¢metro n√£o reconhecido)
- `precompute` (par√¢metro n√£o reconhecido)

Estes warnings n√£o afetam a funcionalidade, mas podem ser corrigidos futuramente.

## üìä Status Final

| Componente | Status | Detalhes |
|------------|--------|----------|
| Odoo Server | ‚úÖ Running | 9 workers, porta 8069 |
| Nginx | ‚úÖ Running | Proxy reverso ativo |
| PostgreSQL | ‚úÖ Running | 7 conex√µes ativas |
| HTTP Test | ‚úÖ 200 OK | Conectividade confirmada |

## üìÖ Data da Corre√ß√£o
**19 de Novembro de 2025 - 18:13 UTC**

---

**Criado por:** Claude + Anderson  
**Scripts:** `diagnose_502.sh`, `fix_502_restart_odoo.sh`

