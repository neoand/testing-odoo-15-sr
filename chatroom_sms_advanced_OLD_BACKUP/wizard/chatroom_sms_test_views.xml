<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Form View Wizard -->
        <record id="view_chatroom_sms_test_form" model="ir.ui.view">
            <field name="name">chatroom.sms.test.form</field>
            <field name="model">chatroom.sms.test</field>
            <field name="arch" type="xml">
                <form string="Teste de SMS">
                    <header>
                        <h3 class="oe_title">
                            <label string="Teste de Envio de SMS"/>
                        </h3>
                        <field name="state" widget="statusbar" statusbar_visible="draft,sent,error"/>
                    </header>

                    <sheet>
                        <group>
                            <group name="test_config" string="Configuração do Teste">
                                <field name="api_id" required="1"
                                       options="{'no_create': True, 'no_create_edit': True}"/>
                                <field name="phone" placeholder="+5511999999999"
                                       help="Digite o número com código do país (Ex: +5511999999999)"/>
                            </group>
                        </group>

                        <group string="Mensagem de Teste">
                            <field name="message" widget="text" nolabel="1"
                                   placeholder="Digite a mensagem que será enviada no teste..."
                                   options="{'height': 80}"/>
                        </group>

                        <separator string="Resultado do Teste"
                                   attrs="{'invisible': [('state', '=', 'draft')]}"/>

                        <group attrs="{'invisible': [('state', '=', 'draft')]}">
                            <group name="result_info" string="Informações da Resposta">
                                <field name="result" readonly="1" nolabel="1" widget="text"
                                       attrs="{'invisible': [('result', '=', False)]}"/>
                                <field name="request_id" readonly="1"/>
                                <field name="message_id" readonly="1"/>
                                <field name="status_code" readonly="1"/>
                            </group>
                        </group>

                        <div class="alert alert-success" role="alert"
                             attrs="{'invisible': [('state', '!=', 'sent')]}">
                            <i class="fa fa-check-circle"/> <strong>Sucesso!</strong>
                            SMS de teste enviado com sucesso. Verifique o telefone informado.
                        </div>

                        <div class="alert alert-danger" role="alert"
                             attrs="{'invisible': [('state', '!=', 'error')]}">
                            <i class="fa fa-exclamation-triangle"/> <strong>Erro!</strong>
                            Ocorreu um erro ao enviar o SMS de teste. Verifique os detalhes acima.
                        </div>

                        <div class="alert alert-info" role="alert"
                             attrs="{'invisible': [('state', '!=', 'draft')]}">
                            <i class="fa fa-info-circle"/> <strong>Instruções:</strong>
                            <ul>
                                <li>Selecione a API SMS configurada</li>
                                <li>Digite um número de telefone válido com código do país (Ex: +5511999999999)</li>
                                <li>Digite uma mensagem de teste</li>
                                <li>Clique em "Enviar Teste" para testar o envio</li>
                                <li>Use "Verificar Saldo" para consultar o saldo disponível na API</li>
                                <li>Use "Testar Webhook" para verificar se o webhook está configurado corretamente</li>
                            </ul>
                        </div>

                    </sheet>

                    <footer>
                        <button name="action_send_test" type="object"
                                string="Enviar Teste" class="oe_highlight"
                                icon="fa-paper-plane"
                                attrs="{'invisible': [('state', '!=', 'draft')]}"
                                help="Envia o SMS de teste para o número informado"/>

                        <button name="action_check_balance" type="object"
                                string="Verificar Saldo" class="btn-secondary"
                                icon="fa-money"
                                attrs="{'invisible': [('state', '!=', 'draft')]}"
                                help="Verifica o saldo disponível na API"/>

                        <button name="action_test_webhook" type="object"
                                string="Testar Webhook" class="btn-secondary"
                                icon="fa-globe"
                                attrs="{'invisible': [('state', '!=', 'draft')]}"
                                help="Envia uma requisição de teste para o webhook configurado"/>

                        <button name="action_reset" type="object"
                                string="Resetar" class="btn-secondary"
                                icon="fa-refresh"
                                attrs="{'invisible': [('state', '=', 'draft')]}"
                                help="Limpa os resultados e reinicia o teste"/>

                        <button string="Fechar" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Action -->
        <record id="action_chatroom_sms_test" model="ir.actions.act_window">
            <field name="name">Teste de SMS</field>
            <field name="res_model">chatroom.sms.test</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>

        <!-- Menu Action -->
        <menuitem id="menu_chatroom_sms_test"
                  name="Teste de SMS"
                  parent="chatroom.menu_chatroom_root"
                  action="action_chatroom_sms_test"
                  sequence="31"/>

    </data>
</odoo>
